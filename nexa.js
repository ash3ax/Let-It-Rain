let scene,camera,renderer,flash,rain,rainGeo,cloudParticles=[],rainCount=5e3;function init(){scene=new THREE.Scene,(camera=new THREE.PerspectiveCamera(60,window.innerWidth/window.innerHeight,1,1e3)).position.z=1,camera.rotation.x=1.16,camera.rotation.y=-.12,camera.rotation.z=.27,ambient=new THREE.AmbientLight(5592405),scene.add(ambient),directionalLight=new THREE.DirectionalLight(16772829),directionalLight.position.set(0,0,1),scene.add(directionalLight),(flash=new THREE.PointLight(404873,30,500,1.7)).position.set(200,300,100),scene.add(flash),renderer=new THREE.WebGLRenderer,scene.fog=new THREE.FogExp2(1118495,.002),renderer.setClearColor(scene.fog.color),renderer.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(renderer.domElement),rainGeo=new THREE.Geometry;for(let e=0;e<rainCount;e++)rainDrop=new THREE.Vector3(400*Math.random()-200,500*Math.random()-250,400*Math.random()-200),rainDrop.velocity={},rainDrop.velocity=0,rainGeo.vertices.push(rainDrop);rainMaterial=new THREE.PointCloudMaterial({color: 0xFFFFFF,size: 0.8,map: loader.load("drop.png"),rain=new THREE.Points(rainGeo,rainMaterial),scene.add(rain),(new THREE.TextureLoader).load("smoke.png",function(e){cloudGeo=new THREE.PlaneBufferGeometry(500,500),cloudMaterial=new THREE.MeshLambertMaterial({map:e,transparent:!0});for(let e=0;e<25;e++){let e=new THREE.Mesh(cloudGeo,cloudMaterial);e.position.set(800*Math.random()-400,500,500*Math.random()-450),e.rotation.x=1.16,e.rotation.y=-.12,e.rotation.z=360*Math.random(),e.material.opacity=.6,cloudParticles.push(e),scene.add(e)}animate()})}function animate(){cloudParticles.forEach(e=>{e.rotation.z-=.002}),rainGeo.vertices.forEach(e=>{e.velocity-=.1+.01*Math.random(),e.y+=e.velocity,e.y<-200&&(e.y=200,e.velocity=0)}),rainGeo.verticesNeedUpdate=!0,rain.rotation.y+=.002,(Math.random()>.93||flash.power>100)&&(flash.power<100&&flash.position.set(400*Math.random(),300+200*Math.random(),100),flash.power=50+500*Math.random()),renderer.render(scene,camera),requestAnimationFrame(animate)}init();
